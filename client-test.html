<!doctype html>
<html>
  <body>
    <h1>Colyseus test</h1>
    <input id="name" placeholder="name" />
    <button id="join">Join</button>
    <pre id="log"></pre>

    <script type="module">
      import * as Colyseus from "https://unpkg.com/colyseus.js@0.15.16/dist/colyseus.js";

      const log = (msg) => (document.getElementById("log").textContent += msg + "\n");

      document.getElementById("join").onclick = async () => {
        const client = new Colyseus.Client("ws://localhost:2567");
        const room = await client.joinOrCreate("battle");
        log("joined: " + room.sessionId);

        room.send("set_name", { name: document.getElementById("name").value });

        room.state.players.onAdd = (player, id) => log("player add " + id);
        room.state.players.onRemove = (_, id) => log("player remove " + id);

        room.onStateChange(() => {
          // shows all players
          const players = [];
          room.state.players.forEach((p, id) => players.push({ id, x: p.x, y: p.y, hp: p.hp, alive: p.alive, name: p.name }));
          document.getElementById("log").textContent = JSON.stringify(players, null, 2);
        });

        // move with mouse
        window.onmousemove = (e) => room.send("move", { x: e.clientX, y: e.clientY });
      };
    </script>
  </body>
</html>
